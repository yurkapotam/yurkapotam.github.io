<!DOCTYPE html>
<html>
    <head>
        <title>ExtRTS</title>
        <style>
            html
            {
                height: 100%;
                width: 100%;
                overflow: scroll;
            }
            
            body
            {
                margin: 0px;
                height: 100%;
                width: 100%;
                overflow: scroll;
            }
            
            .row
            {
                overflow-x: visible;
                overflow-y: hidden;
                display: inline;
            }

            #world
            {
                overflow: scroll;
                height: 100%;
                width: 100%;
                background-color: black;
            }
            
            .tile
            {
                height: 100px;
                width: 100px;
                overflow: hidden;
                background-image: var(--tile-image);
            }
        </style>
    </head>
    <body>
        <a id="loading">Loading...</a>
        <div id="world" style="display: none;"></div>
        <script>
            // https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
            function getqueryparam(name, url = window.location.href) {
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
                results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }
            
            var map_request = new XMLHttpRequest();
            map_request.open("GET", getqueryparam("mapurl"), false);
            map_request.send();
            var map_doc = new DOMParser().parseFromString(map_request.response, "application/xml");

            var cur_map = "";
            map_doc.querySelectorAll("coordinates y").forEach(y =>
            {
                cur_map += "<div class=\"row\">";
                map_doc.querySelectorAll("coordinates y x").forEach(x =>
                {
                    cur_map += "<img class=\"tile\" style=\"--tile-image=\\\"" + x.getAttribute("h") + "\\\";\"></img>";
                });
                cur_map += "</div>";
            });
            document.getElementById("loading").style = "display: none;";
            document.getElementById("world").innerHTML = cur_map;
            document.getElementById("world").style = "display: block;";
        </script>
    </body>
</html>
